# Redis基础课程10讲大纲
## 预备知识
- Go基础（goroutine、interface）
- Docker基础操作
- HTTP基础
---

### **第1讲：Redis入门与Go生态对接**
**内容边界：**
- Redis核心概念、Docker部署、CLI基础操作
- 单线程+IO多路复用架构
- go-redis客户端初始化、配置与基础CRUD
- **实战**：搭建Go+Redis环境，实现`Ping`检测

**面试题穿插：**
1. **Q1：Redis是单线程的，为什么还能这么快？**
    - 考点：考察IO多路复用、内存操作、避免上下文切换等核心原理
    - 追问：单线程架构有什么局限性？什么场景下会成为瓶颈？

2. **Q2：go-redis的连接池参数如何配置？最大连接数设多少合理？**
    - 考点：连接池设计、maxIdle、maxActive、idleTimeout含义
    - 警示：连接池不是越大越好，需结合服务器文件句柄数和业务并发量

**总结**：理解Redis定位，掌握Go项目集成方式

---

### **第2讲：String类型与缓存模式**
**内容边界：**
- String命令（`GET/SET/MSET/INCR/SETEX`）
- 应用场景：缓存、计数器、分布式锁
- **实战**：高性能**文章阅读计数器**（原子递增+过期策略）
- 缓存设计模式：Cache-Aside、防穿透初步

**面试题穿插：**
1. **Q3：如何用Redis实现一个分布式锁？SETNX和SET EX NX有什么区别？**
    - 考点：SETNX原子性、过期时间防止死锁、早期版本缺陷
    - 延伸：说说Redisson的看门狗机制（留悬念，后续展开）

2. **Q4：缓存穿透是什么？如何用String类型做基础防护？**
    - 考点：穿透 vs 击穿 vs 雪崩的区分
    - 方案：空值缓存、BloomFilter思路引导

**总结**：String作为最常用类型的选型原则

---

### **第3讲：Hash类型与对象建模**
**内容边界：**
- Hash命令（`HGET/HSET/HGETALL/HINCRBY`）
- 应用场景：结构化数据存储、用户信息
- **实战**：**用户资料管理系统**（对比String存储的优劣）
- 数据建模原则：何时用Hash而非String

**面试题穿插：**
1. **Q5：存储用户对象，用String（JSON）还是Hash更好？什么场景下必须选Hash？**
    - 考点：内存占用、字段局部更新、网络传输开销
    - 警惕：Hash不适合存储超大对象（hgetall阻塞风险）

2. **Q6：HGETALL在生产环境有什么风险？如何优化？**
    - 考点：大数据量阻塞、Redis单线程模型影响
    - 方案：HSCAN分批次获取、只获取必要字段

**总结**：掌握对象粒度控制与内存优化技巧

---

### **第4讲：List类型与队列模式**
**内容边界：**
- List命令（`LPUSH/RPOP/BLPOP/LRANGE/LLEN`）
- 应用场景：消息队列、最新动态、任务调度
- **实战**：**异步任务队列**（生产者-消费者+Go协程）
- 队列选型对比：Redis List vs 专业MQ

**面试题穿插：**
1. **Q7：用List实现队列时，如果消费者挂了，消息会丢失吗？如何缓解？**
    - 考点：RPOP的破坏性消费、BRPOPLPUSH的安全队列模式
    - 对比：Ack机制，引出Redis不是可靠MQ

2. **Q8：List和Go的channel有什么区别？什么场景用哪个？**
    - 考点：跨进程通信、持久化、容量限制
    - 引导理解：进程内解耦用channel，跨服务用Redis

**总结**：理解List作为轻量级队列的适用边界

---

### **第5讲：Set类型与关系运算**
**内容边界：**
- Set命令（`SADD/SMEMBERS/SINTER/SUNION/SPOP`）
- 应用场景：标签系统、好友关系、抽奖去重
- **实战**：**文章标签系统**（标签添加、交集查询、随机推荐）
- 集合运算性能考量

**面试题穿插：**
1. **Q9：如何用Set实现一个微信式的"可能认识的人"功能？**
    - 考点：SINTER求共同好友、好友的二级好友扩散
    - 追问：数据量大了性能扛不住怎么办？（预留：下讲SScan）

2. **Q10：SPOP和SRANDMEMBER有什么区别？抽奖系统用哪个？**
    - 考点：是否移除元素、重复抽奖需求
    - 场景：SRANDMEMBER可重复中奖（如转盘），SPOP唯一中奖（如抽奖）

**总结**：掌握Set在关系计算中的独特价值

---

### **第6讲：Sorted Set与排行榜设计**
**内容边界：**
- Sorted Set命令（`ZADD/ZRANGE/ZREVRANK/ZINCRBY`）
- 应用场景：排行榜、延迟队列
- **实战**：**游戏积分排行榜**（实时排名、Top10、段位查询）
- Score设计技巧：时间戳编码、多维度权重

**面试题穿插：**
1. **Q11：Sorted Set的Score相同，如何按时间二次排序？**
    - 考点：Score编码技巧（时间戳作为小数部分）
    - 代码：`ZADD key (timestamp*10000000000 + (MAX_TIME - real_score)) member`

2. **Q12：排行榜数据量上千万，查询Top100会不会很慢？**
    - 考点：SkipList实现、ZRANGE时间复杂度O(log(N)+M)
    - 延伸：如何分页查询？ZREVRANGEBYSCORE

**总结**：理解Sorted Set是唯一可排序集合的优势

---

### **第7讲：高级类型与HyperLogLog应用**
**内容边界：**
- Bitmap、HyperLogLog、Geospatial、Stream
- **实战**：**用户签到与DAU统计系统**（Bitmap签到，HyperLogLog统计）
- 内存对比：HyperLogLog vs Set

**面试题穿插：**
1. **Q13：HyperLogLog统计DAU的误差有多大？2.64KB能存多少数据？**
    - 考点：误差率0.81%、12KB标准内存（2.64是老版本）
    - 追问：什么场景下绝对不能接受这个误差？（如金融对账）

2. **Q14：Bitmap存用户签到，key怎么设计？如何查询用户连续签到天数？**
    - 考点：key = `sign:202501:userId`，位运算技巧
    - 扩展：Lua脚本实现连续签到计算

**总结**：掌握特殊场景下的降本增效方案

---

### **第8讲：Redis核心机制与发布订阅**
**内容边界：**
- 持久化：RDB与AOF原理、配置、选型
- 事务：`MULTI/EXEC/WATCH`的有限原子性
- 发布订阅：`PUBLISH/SUBSCRIBE`
- **实战**：**配置中心**（监听配置变更，Go服务热更新）
- 机制局限性：事务非ACID、发布订阅无持久化

**面试题穿插：**
1. **Q15：RDB和AOF各有什么优缺点？生产环境如何选择？**
    - 考点：RDB恢复快但丢数据，AOF安全但文件大
    - 标准答案：混合持久化（RDB+AOF），Redis 4.0+

2. **Q16：Redis事务和MySQL事务有什么区别？WATCH机制如何实现乐观锁？**
    - 考点：Redis事务无回滚、WATCH的CAS机制
    - 代码演示：WATCH + MULTI实现余额扣减

**总结**：理解Redis底层机制，避免误用陷阱

---

### **第9讲：性能优化与高可用架构**
**内容边界：**
- 性能优化：Pipeline、Lua脚本、连接池
- 高可用：主从复制、哨兵、Cluster
- **实战**：**Pipeline优化接口性能**（合并多次查询）
- 缓存策略：雪崩、击穿、穿透

**面试题穿插：**
1. **Q17：缓存雪崩、击穿、穿透的区别和解决方案？**
    - 考点：三者的触发条件、影响范围
    - 方案：雪崩（随机过期）、击穿（互斥锁/逻辑过期）、穿透（布隆过滤器）

2. **Q18：Redis Cluster的key是如何分配到有数据的？**
    - 考点：哈希槽（16384个）、CRC16算法
    - 追问：批量操作MGET跨越多个槽位怎么办？（HashTag强制分片）

**总结**：掌握生产级Redis调优与架构思维

---

### **第10讲：综合实战 - 社交媒体点赞关注系统**
**内容边界：**
- 强制混合使用：String、Hash、Set、Sorted Set、Bitmap、Pipeline、Lua、过期策略
- **项目需求**：点赞、关注、排行榜

**面试题穿插：**
1. **Q19：设计这个系统时，你如何保证点赞操作的原子性？（代码评审式提问）**
    - 考点：Lua脚本、分布式锁、Redis事务的取舍
    - 引导：展示Lua脚本代码，解释为什么不用MULTI

2. **Q20：如果Feed流列表过长（如关注了大V），怎么优化拉取性能？**
    - 考点：Feed流推拉模式、读写分离、分页缓存
    - 深度追问：如何防止Feed流重复写入？（幂等性设计）

### **交付物**
- 完整Go项目代码（分层架构）
- 单元测试与压测报告
- 大秦授课视频
- **最终回顾**：全课程知识点脑图、Redis选型决策树、面试高频考点汇总